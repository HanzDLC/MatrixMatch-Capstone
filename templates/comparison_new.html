{% extends "base.html" %}
{% block title %}Start New Comparison - MatrixMatch{% endblock %}

{% block content %}
{% set default_program = request.args.get('program_filter', 'ALL') %}
<div class="page-shell">
    <section class="page-header">
        <div>
            <h1 class="page-title">Start New Research Comparison</h1>
            <p class="page-subtitle">
                Follow the three-step process to compare your abstract against stored documents.
            </p>
        </div>
    </section>

    <section class="comparison-wizard">
        <div class="wizard-steps">
            <article class="wizard-step">
                <p class="wizard-step__label">Step 1</p>
                <p class="wizard-step__title">Keywords</p>
            </article>
            <article class="wizard-step">
                <p class="wizard-step__label">Step 2</p>
                <p class="wizard-step__title">Abstract Context</p>
            </article>
            <article class="wizard-step">
                <p class="wizard-step__label">Step 3</p>
                <p class="wizard-step__title">Threshold and Program</p>
            </article>
        </div>

        <form class="form-grid card" id="comparisonForm" method="post" action="{{ url_for('comparison_new') }}">
            <div class="form-block">
                <label class="form-label">Keywords (minimum 5)</label>
                <p class="form-help">
                    Type a keyword then press Enter. Remove a keyword using the close mark on each tag.
                </p>
                <div class="chip-input" id="keywordInputWrapper">
                    <div class="chip-list" id="keywordList"></div>
                    <input
                        type="text"
                        id="keywordInput"
                        class="chip-input__field"
                        placeholder="Example: object detection"
                        autocomplete="off"
                    >
                </div>
                <input type="hidden" name="keywords" id="keywordsHidden">
                <p class="form-help" id="keywordCountText">0 keywords added.</p>
            </div>

            <div class="form-block">
                <label for="abstract" class="form-label">Research Abstract</label>
                <textarea
                    id="abstract"
                    name="abstract"
                    class="form-textarea"
                    rows="11"
                    placeholder="Paste the full abstract you want to compare..."
                    required
                ></textarea>
                <p class="form-help abstract-meta" id="abstractMeta">
                    0 words | 0 characters
                </p>
            </div>

            <div class="grid grid-2">
                <div class="form-block">
                    <label for="program_filter" class="form-label">Academic Program</label>
                    <select id="program_filter" name="program_filter" class="form-input">
                        <option value="ALL" {% if default_program == 'ALL' %}selected{% endif %}>All Programs</option>
                        <option value="BSIT" {% if default_program == 'BSIT' %}selected{% endif %}>BSIT</option>
                        <option value="BSCS" {% if default_program == 'BSCS' %}selected{% endif %}>BSCS</option>
                        <option value="BSIS" {% if default_program == 'BSIS' %}selected{% endif %}>BSIS</option>
                    </select>
                </div>

                <div class="form-block range-group">
                    <label for="threshold" class="form-label">
                        Similarity Threshold <span id="thresholdValue">60%</span>
                    </label>
                    <input
                        type="range"
                        id="threshold"
                        name="threshold"
                        min="60"
                        max="100"
                        step="5"
                        value="60"
                        class="range-input"
                    >
                    <div class="range-marks">
                        <span>60%</span>
                        <span>80%</span>
                        <span>100%</span>
                    </div>
                </div>
            </div>

            <div class="form-actions">
                <button type="submit" class="btn btn-primary">Run Comparison</button>
                <a href="{{ url_for('dashboard') }}" class="btn btn-secondary">Cancel</a>
            </div>
        </form>
    </section>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="{{ url_for('static', filename='js/comparison.js') }}"></script>
{% endblock %}
